{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/ElderEase-main/ElderEase-main/src/app/profile/page.tsx"],"sourcesContent":["'use client'\n\nimport { useState, useEffect } from 'react'\nimport { useRouter } from 'next/navigation'\nimport { doc, getDoc, setDoc } from 'firebase/firestore'\nimport { ref, uploadBytes, getDownloadURL } from 'firebase/storage'\nimport { updatePassword, reauthenticateWithCredential, EmailAuthProvider } from 'firebase/auth'\nimport app, { auth, db, storage } from '@/lib/firebaseConfig'\n\ninterface UserProfile {\n  id: string\n  name: string\n  email: string\n  phone: string\n  profilePhoto?: string\n}\n\nexport default function Profile() {\n  const router = useRouter()\n  const [profile, setProfile] = useState<UserProfile>({ id: '', name: '', email: '', phone: '' })\n  const [originalProfile, setOriginalProfile] = useState<UserProfile | null>(null)\n  const [isEditing, setIsEditing] = useState(false)\n  const [isChangingPassword, setIsChangingPassword] = useState(false)\n  const [passwordData, setPasswordData] = useState({ currentPassword: '', newPassword: '', confirmPassword: '' })\n  const [message, setMessage] = useState('')\n  const [isLoading, setIsLoading] = useState(true)\n  const [isUploadingPhoto, setIsUploadingPhoto] = useState(false)\n  const [isSaving, setIsSaving] = useState(false)\n\n\n  useEffect(() => {\n    loadUserProfile()\n  }, [])\n\n  const loadUserProfile = async () => {\n    setIsLoading(true)\n    try {\n      const user = auth.currentUser\n      const userId = user?.uid || localStorage.getItem('elderease_user_id')\n      if (!userId) return router.push('/login')\n\n      const snap = await getDoc(doc(db, 'users', userId))\n      if (snap.exists()) {\n        const data = { id: userId, ...snap.data() } as UserProfile\n        setProfile(data)\n        setOriginalProfile(data) // store original for cancel\n        localStorage.setItem('elderease_user', JSON.stringify(data))\n        localStorage.setItem('elderease_user_id', userId)\n      } else {\n        setMessage('Profile not found.')\n      }\n    } catch (err) {\n      console.error(err)\n      setMessage('Error loading profile')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleProfileChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setProfile({ ...profile, [e.target.name]: e.target.value })\n\n  const handlePasswordChange = (e: React.ChangeEvent<HTMLInputElement>) =>\n    setPasswordData({ ...passwordData, [e.target.name]: e.target.value })\n\nconst handleSaveProfile = async (e: React.FormEvent) => {\n  e.preventDefault()\n  setIsSaving(true)  // start saving\n  try {\n    const userId = profile.id || localStorage.getItem('elderease_user_id')\n    if (!userId) return setMessage('User not found.')\n    await setDoc(doc(db, 'users', userId), profile, { merge: true })\n    setOriginalProfile(profile)\n    localStorage.setItem('elderease_user', JSON.stringify(profile))\n    setMessage('Profile updated successfully!')\n    setIsEditing(false)\n  } catch (err) {\n    console.error(err)\n    setMessage('Error updating profile')\n  } finally {\n    setIsSaving(false) // done saving\n    setTimeout(() => setMessage(''), 3000)\n  }\n}\n\n\n\n  const handleCancelEdit = () => {\n    if (originalProfile) setProfile(originalProfile)\n    setIsEditing(false)\n  }\n\n  const handleProfilePhotoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0]\n    if (!file) return\n    setIsUploadingPhoto(true)\n    try {\n      const userId = profile.id || localStorage.getItem('elderease_user_id')\n      if (!userId) return setMessage('User not found.')\n      const storageRef = ref(storage, `profilePhotos/${userId}`)\n      await uploadBytes(storageRef, file)\n      const url = await getDownloadURL(storageRef)\n      const updatedProfile = { ...profile, profilePhoto: url }\n      setProfile(updatedProfile)\n      setOriginalProfile(updatedProfile)\n      await setDoc(doc(db, 'users', userId), updatedProfile, { merge: true })\n      localStorage.setItem('elderease_user', JSON.stringify(updatedProfile))\n      setMessage('Profile photo updated!')\n    } catch (err) {\n      console.error(err)\n      setMessage('Error uploading photo')\n    } finally {\n      setIsUploadingPhoto(false)\n      setTimeout(() => setMessage(''), 3000)\n    }\n  }\n\n  const handleChangePassword = async (e: React.FormEvent) => {\n    e.preventDefault()\n    if (!auth.currentUser) return setMessage('No logged-in user.')\n    if (passwordData.newPassword !== passwordData.confirmPassword) return setMessage('Passwords do not match.')\n    try {\n      const credential = EmailAuthProvider.credential(auth.currentUser.email!, passwordData.currentPassword)\n      await reauthenticateWithCredential(auth.currentUser, credential)\n      await updatePassword(auth.currentUser, passwordData.newPassword)\n      setMessage('Password updated successfully!')\n      setPasswordData({ currentPassword: '', newPassword: '', confirmPassword: '' })\n      setIsChangingPassword(false)\n    } catch (err: any) {\n      console.error(err)\n      if (err.code === 'auth/wrong-password') setMessage('Current password is incorrect.')\n      else setMessage('Error changing password.')\n    } finally {\n      setTimeout(() => setMessage(''), 4000)\n    }\n  }\n\n  const handleLogout = () => { localStorage.clear(); router.push('/login') }\n\n  if (isLoading) return <div className=\"flex justify-center items-center h-screen text-gray-600\">Loading...</div>\n\n  return (\n    <div className=\"min-h-screen bg-white py-10 px-4\">\n      <div className=\"max-w-md mx-auto p-6 bg-white rounded-3xl shadow-lg border border-gray-200\">\n        <div className=\"flex justify-between items-center mb-6\">\n          <button onClick={() => router.push('/')} className=\"text-blue-500 font-medium hover:underline\">‚Üê Home</button>\n          <h1 className=\"text-2xl font-bold text-gray-800\">Profile</h1>\n          <button onClick={handleLogout} className=\"text-red-500 font-medium hover:underline\">Logout</button>\n        </div>\n\n        {message && <div className={`p-3 mb-4 rounded ${message.includes('Error') ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`}>{message}</div>}\n\n        <div className=\"flex flex-col items-center mb-6\">\n          <div className=\"w-28 h-28 rounded-full overflow-hidden border-4 border-gray-200 shadow-lg\">\n            {profile.profilePhoto ? <img src={profile.profilePhoto} alt=\"Profile\" className=\"w-full h-full object-cover\" /> : <span className=\"text-gray-400 text-4xl flex justify-center items-center h-full\">üë§</span>}\n          </div>\n          <input type=\"file\" id=\"profilePhoto\" className=\"hidden\" accept=\"image/*\" onChange={handleProfilePhotoUpload} disabled={isUploadingPhoto} />\n          <label htmlFor=\"profilePhoto\" className={`mt-3 px-4 py-2 rounded-full ${isUploadingPhoto ? 'bg-gray-300 cursor-not-allowed' : 'bg-blue-500 hover:bg-blue-600 cursor-pointer'} text-white font-medium`}>\n            {isUploadingPhoto ? 'Uploading...' : 'Change Photo'}\n          </label>\n        </div>\n\n    <div className=\"space-y-4 text-black\">\n  {['name', 'email', 'phone'].map(field => (\n    <div key={field}>\n      <label className=\"block text-sm font-medium text-gray-800 capitalize\">{field}</label>\n      <input\n        type={field === 'email' ? 'email' : 'text'}\n        name={field}\n        value={profile[field as keyof UserProfile] || ''}\n        onChange={handleProfileChange}\n        disabled={!isEditing}\n        className={`mt-1 w-full px-3 py-2 rounded-xl border ${isEditing ? 'border-blue-400 focus:ring-2 focus:ring-blue-400' : 'border-gray-300'} focus:outline-none transition bg-white`}\n      />\n    </div>\n  ))}\n\n  {isEditing && (\n    <form onSubmit={handleSaveProfile} className=\"flex justify-between mt-4\">\n      <button\n  type=\"submit\"\n  className=\"bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 transition flex items-center justify-center\"\n  disabled={isSaving}\n>\n  {isSaving ? (\n    <svg className=\"animate-spin h-5 w-5 mr-2 text-white\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\">\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\"></circle>\n      <path className=\"opacity-75\" fill=\"currentColor\" d=\"M4 12a8 8 0 018-8v8H4z\"></path>\n    </svg>\n  ) : null}\n  {isSaving ? 'Saving...' : 'Save'}\n</button>\n\n    </form>\n  )}\n\n  {!isEditing && (\n    <button\n      type=\"button\"\n      onClick={() => setIsEditing(true)}\n      className=\"bg-blue-500 text-white px-4 py-2 rounded-full hover:bg-blue-600 transition mt-4\"\n    >\n      Edit Profile\n    </button>\n  )}\n</div>\n\n\n      \n\n        <div className=\"mt-6 pt-6 border-t\">\n          <button onClick={() => setIsChangingPassword(!isChangingPassword)} className=\"bg-yellow-500 text-white px-4 py-2 rounded-full hover:bg-yellow-600 transition\">\n            {isChangingPassword ? 'Cancel Password Change' : 'Change Password'}\n          </button>\n\n          {isChangingPassword && (\n            <form onSubmit={handleChangePassword} className=\"mt-4 space-y-4 text-black\">\n              {['currentPassword', 'newPassword', 'confirmPassword'].map(field => (\n                <div key={field}>\n                  <label className=\"block text-sm font-medium text-gray-600 capitalize\">{field.replace(/([A-Z])/g, ' $1')}</label>\n                  <input\n                    type=\"password\"\n                    name={field}\n                    value={passwordData[field as keyof typeof passwordData]}\n                    onChange={handlePasswordChange}\n                    className=\"mt-1 w-full px-3 py-2 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-400 transition\"\n                  />\n                </div>\n              ))}\n              <button type=\"submit\" className=\"bg-green-500 text-white px-4 py-2 rounded-full hover:bg-green-600 transition\">Update Password</button>\n            </form>\n          )}\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}